{% extends 'base.html' %}
{% block title %}{{ event.title }} - SGEA{% endblock %}

{% block content %}
<div class="container" style="max-width: 700px; margin: 3rem auto;">
  <div class="card shadow-sm border-0">
    <div class="card-body">

      {% if event.banner %}
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <img src="{{ event.banner.url }}" 
               alt="Banner do evento"
               style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        </div>
      {% endif %}

      <h2 class="text-ceub mb-3">ğŸ“Œ {{ event.title }}</h2>

      <p><strong>ğŸ“‚ Tipo:</strong> {{ event.get_event_type_display }}</p>

      <p>
        <strong>ğŸ—“ Data:</strong>
        {% if event.start_date == event.end_date %}
          Dia {{ event.start_date|date:"d \d\e F \d\e Y" }},
          das {{ event.start_time|time:"H:i" }} Ã s {{ event.end_time|time:"H:i" }}
        {% else %}
          Do dia {{ event.start_date|date:"d" }}
          atÃ© {{ event.end_date|date:"d \d\e F \d\e Y" }},
          das {{ event.start_time|time:"H:i" }} Ã s {{ event.end_time|time:"H:i" }}
        {% endif %}
      </p>

      <p><strong>ğŸ“ Local:</strong> {{ event.location }}</p>
      <p><strong>ğŸ‘¤ ResponsÃ¡vel:</strong> {{ event.organizer }}</p>
      <p><strong>ğŸ‘¥ Inscritos:</strong> {{ participants_count }} de {{ event.max_participants }} vagas</p>

      {% if event.description %}
        <hr>
        <p>{{ event.description }}</p>
      {% endif %}

      {# ===== AÃ‡Ã•ES DO ORGANIZADOR ===== #}
      {% if request.user.role == 'organizer' and event.organizer == request.user %}
        <div class="d-flex justify-content-center gap-2 mt-4">
          <a href="{% url 'core:edit_event' event.id %}"
             class="btn"
             style="background-color: #43054E; color: white; font-weight: bold;">
            Editar Evento
          </a>
          <a href="{% url 'core:event_delete' event.id %}"
             class="btn"
             style="background-color: #D32F2F; color: white; font-weight: bold;">
            Excluir Evento
          </a>
        </div>
      {% endif %}

      {# ===== AÃ‡Ã•ES DO PARTICIPANTE ===== #}
      {% if request.user.role != 'organizer' %}
        <form method="post" class="mt-4">
          {% csrf_token %}

          {% if registered %}
            <div class="d-flex justify-content-between align-items-center">
              <button type="submit" name="unsubscribe"
                      class="btn"
                      style="background-color: #D32F2F; color: white;">
                âŒ Cancelar inscriÃ§Ã£o
              </button>

              <a href="{% url 'core:events' %}"
                 class="btn"
                 style="background-color: #e73973; color: white;">
                Voltar
              </a>
            </div>

          {% else %}
            {% if participants_count >= event.max_participants %}
              <div class="alert alert-warning text-center mb-3">
                âš ï¸ Este evento jÃ¡ atingiu o nÃºmero mÃ¡ximo de participantes.
              </div>

              <div class="text-end">
                <a href="{% url 'core:events' %}"
                   class="btn"
                   style="background-color: #e73973; color: white;">
                  Voltar
                </a>
              </div>

            {% else %}
              <div class="d-flex justify-content-between align-items-center">
                <button type="submit" name="subscribe"
                        class="btn"
                        style="background-color: #e73973; color: white;">
                  âœ… Inscrever-se
                </button>

                <a href="{% url 'core:events' %}"
                   class="btn"
                   style="background-color: #e73973; color: white;">
                  Voltar
                </a>
              </div>
            {% endif %}
          {% endif %}
        </form>
      {% endif %}

      {# ===== LISTA DE PARTICIPANTES ===== #}
      {% if is_organizer %}
        <hr class="my-4">
        <h3 class="text-ceub mb-3">ğŸ‘¥ Participantes</h3>

        <div class="list-group">
          {% for participant in participants %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                {{ participant.get_full_name|default:participant.username }}
              </span>
              <a href="{% url 'core:emitir_certificado' event.id participant.id %}"
                 class="btn"
                 style="background-color: #43054E; color: white;">
                ğŸ“ Emitir Certificado
              </a>
            </div>
          {% empty %}
            <div class="list-group-item">
              Nenhum participante inscrito ainda.
            </div>
          {% endfor %}
        </div>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
